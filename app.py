import streamlit as st
import pandas as pd
import plotly.express as px

# إعداد الصفحة
st.set_page_config(page_title="لوحة متابعة المبيعات", layout="wide")
st.title("📊 لوحة متابعة أداء مندوبي المبيعات")
st.markdown("تحليل شامل لأداء المندوبين من حيث المبيعات وعدد العملاء والمتعاملين")

# البيانات
data = {
    "اسم المندوب": ["إبراهيم جلال", "بدر", "هند", "آلاء", "جهاد", "شيماء وجيه", "أسماء عنبة", "جوري", "مصطفى", "حمدي"],
    "الهدف الشهري": [80000, 50000, 30000, 30000, 30000, 6000, 6000, 30000, 60000, 60000],
    "الحد الأدنى": [56000, 35000, 18000, 18000, 18000, 4200, 4200, 24000, 45000, 45000],
    "صافي المبيعات": [81383.07, 18000, 20574.8, 12171.84, 11600, 4452.95, 4448.09, 25000, 81608.98, 82609.9],
    "تحقيق الهدف مبيعات": [1.02, 0.36, 0.69, 0.41, 0.39, 0.74, 0.74, 0.83, 1.36, 1.38],
    "عدد العملاء": [5, 11, 4, 3, 2, 1, 1, 3, 4, 4],
    "عدد المتعاملين": [10, 23, 6, 5, 4, 2, 2, 5, 6, 6],
    "تحقيق الهدف تعاملات": [0.5, 0.48, 0.67, 0.6, 0.5, 0.5, 0.5, 0.6, 0.67, 0.67]
}

df = pd.DataFrame(data)

# مؤشرات الأداء الرئيسية
col1, col2, col3 = st.columns(3)
col1.metric("📈 متوسط تحقيق المبيعات", f"{df['تحقيق الهدف مبيعات'].mean():.2f}")
col2.metric("👥 متوسط تحقيق التعاملات", f"{df['تحقيق الهدف تعاملات'].mean():.2f}")
col3.metric("🏅 أعلى مندوب مبيعات", df.loc[df['تحقيق الهدف مبيعات'].idxmax(), 'اسم المندوب'])

# رسم بياني: تحقيق المبيعات
st.subheader("📊 معدل تحقيق المبيعات لكل مندوب")
fig1 = px.bar(df, x="اسم المندوب", y="تحقيق الهدف مبيعات", color="تحقيق الهدف مبيعات",
              text="تحقيق الهدف مبيعات", color_continuous_scale="Viridis")
st.plotly_chart(fig1, use_container_width=True)

# رسم بياني: تحقيق التعاملات
st.subheader("👥 معدل تحقيق التعاملات لكل مندوب")
fig2 = px.bar(df, x="اسم المندوب", y="تحقيق الهدف تعاملات", color="تحقيق الهدف تعاملات",
              text="تحقيق الهدف تعاملات", color_continuous_scale="Blues")
st.plotly_chart(fig2, use_container_width=True)

# رسم بياني: صافي المبيعات
st.subheader("💰 صافي المبيعات مقارنة بالهدف الشهري")
fig3 = px.scatter(df, x="الهدف الشهري", y="صافي المبيعات", color="اسم المندوب",
                  size="صافي المبيعات", hover_name="اسم المندوب", title="صافي المبيعات مقابل الهدف")
st.plotly_chart(fig3, use_container_width=True)

# جدول البيانات
st.subheader("📋 الجدول التفصيلي لأداء المندوبين")
st.dataframe(df)

# فلترة حسب اسم المندوب
selected = st.selectbox("🔍 اختر اسم المندوب لعرض التفاصيل", df["اسم المندوب"])
filtered = df[df["اسم المندوب"] == selected]
st.write("📌 بيانات المندوب المختار:")
st.dataframe(filtered)

# حركة إضافية: تنبيه إذا كان الأداء أقل من الحد الأدنى
low_perf = df[df["تحقيق الهدف مبيعات"] < 0.5]
if not low_perf.empty:
    st.warning("⚠️ يوجد مندوبين أداءهم أقل من 50% في المبيعات:")
    st.dataframe(low_perf[["اسم المندوب", "تحقيق الهدف مبيعات"]])
